{% extends 'core/plantilla.html' %}

{% load static %}
{% block title %}REGISTRO PRODUCTO{% endblock %}
{% block css%}
<link rel="stylesheet" href="{% static 'css/pedido.css' %}">
{% endblock %}
{% block content %}
<div class="container">
    <div class="row bg-dark text-white rounded p-5 mt-4 mb-4">
        <h1>Registro nuevos Pedido</h1>
    </div>
    <div class="row">
       {% if 'ok' in request.GET %}
            <div class="alert alert-success alert-dismissible fade show" role="alert">
                <strong>Ok!!! </strong>Producto registrado satisfactoriamente
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>
        {% endif %}
        {% if 'fail' in request.GET %}
            <div class="alert alert-danger alert-dismissible fade show" role="alert">
                <strong>Ups!!! </strong>En estos momentos no podemos atender a tu solicitud... inténtalo más tarde
                <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
            </div>
        {% endif %}
    </div>
    <div>
        <!-- Formulario de contacto --> 
        <form action="" method="POST" id="formulario" enctype="multipart/form-data">
            {% csrf_token %}
                <div class="row">
                    <div class="form-group mb-3">             
                        <div>
                            <select name="idproveedor" id="idproveedor" onchange="llenarcbxprod()">
                                <option value="" selected>----------</option>
                                {% for i in proveedor %}
                                <option value="{{i.idproveedor}}">{{i.nmbproveedor}}</option>
                                {% endfor %}
                            
                            </select>
                        </div>
                    </div>
                </div>

                <div class="row mt-5">
                    <div class="row">
                        <div class="row bg-dark text-white rounded p-2 mb-4">
                            <h3>Productos Agregados</h3>
                        </div> 
                    </div>
                </div>

                <div class="row">
                    <div class="row">
                        <div class="col">
                            <div class="form-group mb-3">
                                <label class="fw-bold">Elegir Producto:</label>
                                <select name="producto" id="producto" >
                            
                                </select>              
                     
                                <input type="text" id="cantProd" name="cantProd" >

                                <button name="" onclick="llenarListadoProductos()">Agregar</button>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div>
                <ol>
                    <div class="form-group mb-3">
                        <label class="fw-bold">proveedor: *</label>
                        <div class="input-group">
                            {{form.idproveedor}}
                        </div>                
                        {{form.idproveedor.errors}}
                    </div>
                    <li><input type="text" id="provid" name="provid" value="22">Elemento 1</li>
                    <li><input type="text" id="2" name="2" value="30">Elemento 2</li>
                    
                    <li><input type="text" id="2" name="2" value="40">Elemento N</li>
                  </ol>
                </div>

                <div class="table-responsive">
                    <table id="tabla_productos" class="table table-striped table-hover" >     
                        <tr class="table-dark">
                            <td>Codigo</td> 
                            <td>Producto</td> 
                            <td>Cantidad</td>                                    
                        </tr>
                    </table>
                </div>

                <div>
                    
                    <!-- contenedor listado productos pedido  -->
                    <div id="container"/>
                </div>

                <div>
                    <input type="submit" class="btn btn-primary btn-block py-2" id="enviar" value="Enviar">
                </div>
        </form>
    </div> 
</div>
{% endblock %}
{% block scripts %}>
<script src="{% static 'js/datepick.js' %}"></script>
<script>

    function llenarcbxprod(){
        let proveedorId = document.getElementById("idproveedor").value;
        let url = '/cbxProductoProveedor/?idproveedor='+proveedorId;
        fetch(url)
        .then(function(result){
            return result.text();
        })
        .then(function(result){
            document.getElementById('producto').innerHTML = result;
        });

        document.getElementById('provid').value = proveedorId
        alert(proveedorId);
        
    };


    /*
    function llenarTabla(){
        
            event.preventDefault();
            var combo = document.getElementById("producto");
            var selected = combo.options[combo.selectedIndex].text;

            var table = document.getElementById("tabla_productos");
            var row = table.insertRow(-1);
            var cell1 = row.insertCell(0);
            var cell2 = row.insertCell(1);
            var cell3 = row.insertCell(2);
            cell1.innerHTML = document.getElementById("producto").value;
            cell1.id = "productoIdPrueba";
            cell2.innerHTML = selected;
            cell3.innerHTML = document.getElementById("cantProd").value;

    };

    */

    function llenarListadoProductos(){
            // Generate a dynamic number of inputs
            //var number = document.getElementById("member").value;
            // Get the element where the inputs will be added to
            //var container = document.getElementById("container");
            // Remove every children it had before
            //while (container.hasChildNodes()) {
                //container.removeChild(container.lastChild);
            //}
            //for (i=0;i<number;i++){
                // Append a node with a random text
            //container.appendChild(document.createTextNode("Member "));
                // Create an <input> element, set its type and name attributes
            //var inputCodigo = document.createElement("input");
            //inputCodigo.type = "text";
            //inputCodigo.name = "member";
            //container.appendChild(input);
                // Append a line break 
            //container.appendChild(document.createElement("br"));
            //}




            //llenar input del codigo producto

            event.preventDefault();

            var container = document.getElementById("container");
            var inputCodigo = document.createElement("input");
            inputCodigo.type = "text";
            inputCodigo.name = "inputCodigo";
            inputCodigo.id ="inputCodigo";
            container.appendChild(inputCodigo);
            var codProducto = document.getElementById("producto").value;
            inputCodigo.value=codProducto;
            //document.getElementById('inputCodigo').value = codProducto;


            var inputProducto = document.createElement("input");
            inputProducto.type = "text";
            inputProducto.name = "inputProducto";
            inputProducto.id ="inputProducto";
            container.appendChild(inputProducto);
            var combo = document.getElementById("producto");
            var selected = combo.options[combo.selectedIndex].text;
            inputProducto.value= selected;
            //document.getElementById('inputProducto').value = selected;


            var inputCantidad = document.createElement("input");
            inputCantidad.type = "text";
            inputCantidad.name = "inputCantidad";
            inputCantidad.id ="inputCantidad";
            container.appendChild(inputCantidad);
            var cantProducto = document.getElementById("cantProd").value;
            inputCantidad.value= cantProducto;
            //document.getElementById('inputCantidad').value = cantProducto;


            container.appendChild(document.createElement("br"));

                /*
            event.preventDefault();
            var combo = document.getElementById("producto");
            var selected = combo.options[combo.selectedIndex].text;

            container.appendChild(document.createTextNode("Member "));
            
            var input = document.createElement("input");
            input.type = "text";
            input.name = "member";
            container.appendChild(input);
                // Append a line break 
            container.appendChild(document.createElement("br"));

            document.getElementById('provid').value = proveedorId

            var table = document.getElementById("tabla_productos");
            var row = table.insertRow(-1);
            var cell1 = row.insertCell(0);
            var cell2 = row.insertCell(1);
            var cell3 = row.insertCell(2);
            cell1.innerHTML = container.appendChild(input);
            
            cell1.id = "productoIdPrueba";
            cell2.innerHTML = selected;
            cell3.innerHTML = document.getElementById("cantProd").value;

                */
        }
  


</script>
{% endblock %}